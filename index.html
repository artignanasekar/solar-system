<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solar System Generator — Visual Placeholders</title>

  <style>
    :root{
      --bg: #06070c;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --accent: rgba(155,210,255,0.85);
      --radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; }

    body{
      margin:0;
      font-family: var(--mono);
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;
      overflow-x: hidden;
      letter-spacing: 0.2px;
    }

    body::before, body::after{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-repeat: repeat;
    }
    body::before{
      z-index: -2;
      opacity: 0.85;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.9) 99%, transparent 100%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,0.65) 99%, transparent 100%),
        radial-gradient(1px 1px at 70% 40%, rgba(255,255,255,0.8) 99%, transparent 100%),
        radial-gradient(1px 1px at 90% 70%, rgba(255,255,255,0.55) 99%, transparent 100%),
        radial-gradient(1px 1px at 55% 10%, rgba(255,255,255,0.75) 99%, transparent 100%),
        radial-gradient(1px 1px at 15% 55%, rgba(255,255,255,0.5) 99%, transparent 100%),
        radial-gradient(1px 1px at 45% 65%, rgba(255,255,255,0.7) 99%, transparent 100%),
        radial-gradient(1px 1px at 80% 15%, rgba(255,255,255,0.6) 99%, transparent 100%);
      background-size: 320px 320px;
      filter: drop-shadow(0 0 1px rgba(255,255,255,0.2));
    }
    body::after{
      z-index: -3;
      opacity: 1;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.35) 99%, transparent 100%),
        radial-gradient(2px 2px at 85% 25%, rgba(255,255,255,0.25) 99%, transparent 100%),
        radial-gradient(2px 2px at 60% 85%, rgba(255,255,255,0.22) 99%, transparent 100%),
        radial-gradient(700px 500px at 20% 10%, rgba(155,210,255,0.08) 0%, transparent 60%),
        radial-gradient(650px 520px at 85% 85%, rgba(255,170,210,0.06) 0%, transparent 55%),
        radial-gradient(900px 800px at 55% 50%, rgba(255,255,255,0.03) 0%, transparent 60%);
      background-size: 520px 520px, 520px 520px, 520px 520px, auto, auto, auto;
    }

    .wrap{
      max-width: 1000px;
      margin: 0 auto;
      padding: 16px;
    }

    h3{
      margin: 6px 0 12px;
      font-size: 18px;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      font-weight: 900;
    }

    .sub{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      letter-spacing: 0.45px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items: end;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      backdrop-filter: blur(6px);
    }

    label{
      font-size: 11px;
      color: var(--muted);
      display:block;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    input, button{
      font: inherit;
      color: var(--text);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      padding: 8px 10px;
      outline: none;
      letter-spacing: 0.4px;
    }

    input{ width: 140px; }
    input.wide{ width: 220px; }

    input::placeholder{ color: rgba(255,255,255,0.35); }

    button{
      cursor:pointer;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 10px;
      border: 1px solid rgba(155,210,255,0.35);
      background: rgba(0,0,0,0.35);
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.06) inset,
        0 10px 22px rgba(0,0,0,0.35);
    }
    button.secondary{
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.28);
      font-weight: 750;
    }
    button:hover{ filter: brightness(1.12); }

    .system{
      margin-top: 12px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
      backdrop-filter: blur(6px);
    }

    .systemHeader{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }
    .systemHeader b{ color: var(--text); }

    .chip{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.28);
    }

    .strip{
      display:flex;
      align-items:center;
      gap: 14px;
      padding: 12px;
      min-height: 140px;
      border-radius: 12px;
      border: 1px dashed rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.22);
      overflow-x: auto;
    }

    .orbitGroup{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 7px;
      min-width: 92px;
      flex: 0 0 auto;
    }

    .orbitLine{
      width: 86px;
      height: 2px;
      border-radius: 2px;
      background: rgba(255,255,255,0.10);
    }

    .body{
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.34);
      position: relative;
      box-shadow:
        0 0 0 1px rgba(0,0,0,0.25) inset,
        0 10px 24px rgba(0,0,0,0.45);
      filter: saturate(1.35) brightness(1.15);
      isolation: isolate;
      overflow: visible;
    }

    .body::before{
      content:"";
      position:absolute;
      inset: 0;
      border-radius: 999px;
      background:
        radial-gradient(circle at 28% 25%,
          rgba(255,255,255,0.60) 0%,
          rgba(255,255,255,0.18) 18%,
          rgba(255,255,255,0.00) 45%);
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .body::after{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: 999px;
      box-shadow:
        0 0 0 2px rgba(255,255,255,0.14) inset,
        0 0 24px rgba(255,255,255,0.08);
      pointer-events:none;
    }

    .planet{
      background: none;
      border-color: rgba(255,255,255,0.34);
      filter: saturate(1.55) brightness(1.20);
    }

    .ring::after{
      content:"";
      position:absolute;
      left:50%;
      top:50%;
      width: 150%;
      height: 75%;
      transform: translate(-50%, -50%) rotate(-12deg);
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.26);
      background: transparent;
      pointer-events:none;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.35));
    }

    .label{
      font-size: 12px;
      text-align:center;
      color: rgba(255,255,255,0.88);
      line-height: 1.1;
      text-transform: uppercase;
      letter-spacing: 0.9px;
      font-weight: 900;
    }

    .subLabel{
      font-size: 11px;
      text-align:center;
      color: var(--muted);
      line-height: 1.15;
      max-width: 92px;
      letter-spacing: 0.35px;
    }

    .moons{
      display:flex;
      gap: 5px;
      align-items:center;
      justify-content:center;
      flex-wrap: wrap;
      min-height: 14px;
    }

    .moon{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1.6px solid rgba(255,255,255,0.30);
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,255,0.38) 0%,
          rgba(185,185,185,0.22) 40%,
          rgba(80,80,80,0.38) 78%,
          rgba(0,0,0,0.45) 100%);
      box-shadow:
        0 0 10px rgba(255,255,255,0.06),
        0 6px 12px rgba(0,0,0,0.35);
    }

    .star{
      border-width: 3px;
      filter: saturate(1.45) brightness(1.18);
      box-shadow:
        0 0 18px rgba(255,255,255,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-yellow{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,220,1.0) 0%,
          rgba(255,235,140,0.95) 32%,
          rgba(255,200,70,0.70) 58%,
          rgba(0,0,0,0.20) 100%);
      box-shadow:
        0 0 34px rgba(255,220,120,0.28),
        0 0 90px rgba(255,190,60,0.14),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-blue{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(230,250,255,0.95) 0%,
          rgba(135,225,255,0.85) 34%,
          rgba(60,150,255,0.55) 60%,
          rgba(0,0,0,0.22) 100%);
      box-shadow:
        0 0 34px rgba(140,225,255,0.22),
        0 0 90px rgba(60,150,255,0.12),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-white{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,255,0.98) 0%,
          rgba(230,240,255,0.78) 38%,
          rgba(170,200,255,0.40) 66%,
          rgba(0,0,0,0.24) 100%);
      box-shadow:
        0 0 30px rgba(255,255,255,0.18),
        0 0 70px rgba(180,210,255,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-yellowwhite{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,235,0.96) 0%,
          rgba(255,240,170,0.82) 38%,
          rgba(230,190,110,0.45) 66%,
          rgba(0,0,0,0.24) 100%);
      box-shadow:
        0 0 32px rgba(255,240,190,0.18),
        0 0 80px rgba(255,210,120,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-orange{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,240,215,0.92) 0%,
          rgba(255,185,105,0.78) 40%,
          rgba(220,120,45,0.42) 70%,
          rgba(0,0,0,0.24) 100%);
      box-shadow:
        0 0 30px rgba(255,175,100,0.16),
        0 0 75px rgba(220,120,45,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-reddwarf{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,220,220,0.92) 0%,
          rgba(255,120,120,0.72) 38%,
          rgba(210,55,55,0.45) 68%,
          rgba(0,0,0,0.25) 100%);
      box-shadow:
        0 0 28px rgba(255,120,120,0.18),
        0 0 70px rgba(210,55,55,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-whitedwarf{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,255,0.95) 0%,
          rgba(210,235,255,0.72) 40%,
          rgba(120,150,210,0.40) 72%,
          rgba(0,0,0,0.30) 100%);
      box-shadow:
        0 0 26px rgba(220,245,255,0.18),
        0 0 60px rgba(150,200,255,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-neutron{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(230,245,255,0.90) 0%,
          rgba(160,205,255,0.62) 45%,
          rgba(90,130,220,0.34) 75%,
          rgba(0,0,0,0.36) 100%);
      box-shadow:
        0 0 22px rgba(190,220,255,0.16),
        0 0 55px rgba(120,170,255,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .s-blackhole{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(255,255,255,0.10) 0%,
          rgba(0,0,0,0.78) 35%,
          rgba(0,0,0,0.94) 70%,
          rgba(0,0,0,1.0) 100%);
      box-shadow:
        0 0 22px rgba(155,210,255,0.08),
        0 0 60px rgba(255,170,210,0.05),
        0 8px 26px rgba(0,0,0,0.65);
    }

    .s-binary{
      background:
        radial-gradient(circle at 30% 30%,
          rgba(255,255,245,0.96) 0%,
          rgba(255,235,170,0.75) 40%,
          rgba(200,160,100,0.36) 70%,
          rgba(0,0,0,0.26) 100%);
      box-shadow:
        0 0 32px rgba(255,240,190,0.16),
        0 0 80px rgba(255,210,120,0.10),
        0 8px 26px rgba(0,0,0,0.45);
    }

    .p-ocean{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(210,245,255,0.95) 0%,
          rgba(90,195,255,0.88) 36%,
          rgba(20,120,230,0.78) 68%,
          rgba(0,0,0,0.26) 100%),
        radial-gradient(circle at 70% 78%,
          rgba(0,170,255,0.35) 0%,
          transparent 55%);
    }

    .p-rocky{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(245,245,250,0.92) 0%,
          rgba(190,195,210,0.82) 42%,
          rgba(120,130,150,0.72) 72%,
          rgba(0,0,0,0.30) 100%),
        radial-gradient(circle at 70% 78%,
          rgba(255,255,255,0.18) 0%,
          transparent 60%);
    }

    .p-jungle{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(225,255,235,0.92) 0%,
          rgba(110,240,170,0.82) 40%,
          rgba(30,160,95,0.72) 72%,
          rgba(0,0,0,0.30) 100%),
        radial-gradient(circle at 70% 78%,
          rgba(55,210,120,0.24) 0%,
          transparent 60%);
    }

    .p-desert{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(255,250,230,0.92) 0%,
          rgba(250,220,160,0.84) 42%,
          rgba(215,170,110,0.72) 74%,
          rgba(0,0,0,0.30) 100%),
        radial-gradient(circle at 70% 78%,
          rgba(255,235,190,0.22) 0%,
          transparent 60%);
    }

    .p-ice{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(245,253,255,0.92) 0%,
          rgba(185,235,255,0.82) 44%,
          rgba(85,175,235,0.68) 74%,
          rgba(0,0,0,0.34) 100%),
        radial-gradient(circle at 70% 78%,
          rgba(255,255,255,0.22) 0%,
          transparent 60%);
    }

    .p-gas{
      background:
        radial-gradient(circle at 35% 35%,
          rgba(245,230,255,0.78) 0%,
          rgba(190,160,255,0.62) 40%,
          rgba(120,90,210,0.52) 72%,
          rgba(0,0,0,0.38) 100%),
        repeating-linear-gradient(12deg,
          rgba(255,255,255,0.14) 0px,
          rgba(255,255,255,0.14) 7px,
          rgba(0,0,0,0.00) 14px,
          rgba(0,0,0,0.00) 24px);
    }

    .panel{
      margin-top: 12px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: var(--radius);
      background: rgba(0,0,0,0.22);
    }

    pre{
      margin:0;
      white-space: pre-wrap;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(210,255,220,0.85);
      line-height: 1.35;
      letter-spacing: 0.35px;
    }

    .batch{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .mini{
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 14px;
      padding: 10px;
      background: rgba(0,0,0,0.22);
    }

    .miniHeader{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .mini .strip{
      min-height: 110px;
      padding: 10px;
    }
    .mini .orbitGroup{ min-width: 82px; }
    .mini .orbitLine{ width: 78px; }
    .mini .subLabel{ max-width: 82px; }
  </style>
</head>

<body>
  <div class="wrap">
    <h3>Solar System Generator (visual placeholders)</h3>
    <p class="sub">
      Black space + starfield background. Circles are placeholders that can be swapped to images later.
      Two+ parameters for tuning: life frequency, rings threshold, moon frequency, orbit bias.
    </p>

    <div class="controls">
      <div>
        <label>Seed (optional)</label>
        <input id="seed" class="wide" placeholder="arti-01" />
      </div>

      <div>
        <label>Life frequency %</label>
        <input id="lifeFreq" type="number" min="0" max="100" value="45" />
      </div>

      <div>
        <label>Rings threshold (d20 ≥ X)</label>
        <input id="ringThreshold" type="number" min="2" max="20" value="11" />
      </div>

      <div>
        <label>Moon frequency %</label>
        <input id="moonFreq" type="number" min="0" max="100" value="55" />
      </div>

      <div>
        <label>Orbit bias strength (0–3)</label>
        <input id="orbitBias" type="number" min="0" max="3" value="1" />
      </div>

      <button id="gen1">Generate 1</button>
      <button id="gen10" class="secondary">Generate 10</button>
      <button id="gen20" class="secondary">Generate 20</button>
    </div>

    <div id="singleWrap" class="system">
      <div class="systemHeader">
        <span class="chip"><b id="sysName">SYS—</b> <span>seed:</span> <span id="sysSeed">—</span></span>
        <span class="chip"><span>star:</span> <b id="starText">—</b> <span>·</span> <span>planets:</span> <b id="countText">—</b></span>
      </div>
      <div id="strip" class="strip"></div>
    </div>

    <div class="panel">
      <label style="margin:0 0 8px; color: var(--muted); font-size:12px;">Text log (for screenshots + debugging)</label>
      <pre id="log">Click generate.</pre>
    </div>

    <div id="batchWrap" style="display:none;">
      <h4 style="margin:14px 0 8px; color: var(--text);">Batch outputs (screenshot this for Check-in #3)</h4>
      <div id="batch" class="batch"></div>
    </div>
  </div>

<script>
  function xmur3(str) {
    let h = 1779033703 ^ str.length;
    for (let i = 0; i < str.length; i++) {
      h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
      h = (h << 13) | (h >>> 19);
    }
    return function () {
      h = Math.imul(h ^ (h >>> 16), 2246822507);
      h = Math.imul(h ^ (h >>> 13), 3266489909);
      return (h ^= h >>> 16) >>> 0;
    };
  }
  function mulberry32(a) {
    return function () {
      let t = (a += 0x6d2b79f5);
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }
  function makeRng(seedStr) {
    const seed = (seedStr && seedStr.trim()) ? seedStr.trim() : String(Date.now());
    const seedFn = xmur3(seed);
    return { seed, rng: mulberry32(seedFn()) };
  }

  function d(sides, rng) { return 1 + Math.floor(rng() * sides); }
  function roll2d6(rng) { return d(6, rng) + d(6, rng); }
  function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

  function buildDeck() {
    const suits = ["♥","♦","♣","♠"];
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    const deck = [];
    for (const s of suits) for (const r of ranks) deck.push({suit:s, rank:r});
    return deck;
  }
  function shuffle(arr, rng) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(rng() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  const STAR_2D6 = {
    2:"Blue giant", 3:"White star", 4:"Yellow-white star", 5:"Yellow star",
    6:"Orange star", 7:"Red dwarf", 8:"Red dwarf (flares)", 9:"Binary stars",
    10:"White dwarf", 11:"Neutron star", 12:"Black hole"
  };

  const PLANET_2D6 = {
    2:"Airless rock", 3:"Cratered rock", 4:"Rocky thin-atmo", 5:"Rocky habitable-band",
    6:"Ocean world", 7:"Temperate world", 8:"Desert world", 9:"Jungle / super-Earth",
    10:"Ice world", 11:"Gas giant", 12:"Gas giant (massive)"
  };

  const DOMAIN_BY_SUIT = {
    "♥":"Culture/Faith",
    "♦":"Trade/Wealth",
    "♣":"Industry/Science",
    "♠":"Military/Expansion"
  };

  function levelFromRank(rank) {
    if (rank === "A") return "Mythic";
    if (["2","3","4","5"].includes(rank)) return "Early";
    if (["6","7","8","9"].includes(rank)) return "Developing";
    if (rank === "10" || rank === "J") return "Modern";
    if (rank === "Q") return "Advanced";
    if (rank === "K") return "Post-scarcity";
    return "Unknown";
  }

  function sizeForStar(starLabel) {
    if (starLabel.includes("Blue")) return 78;
    if (starLabel.includes("Black hole")) return 64;
    if (starLabel.includes("Neutron")) return 56;
    if (starLabel.includes("White dwarf")) return 48;
    return 62;
  }

  function sizeForPlanet(typeLabel) {
    const t = typeLabel.toLowerCase();
    if (t.includes("gas giant")) return 46;
    if (t.includes("super-earth")) return 38;
    if (t.includes("ocean")) return 36;
    if (t.includes("ice")) return 33;
    if (t.includes("temperate")) return 33;
    if (t.includes("desert")) return 31;
    return 27;
  }

  function genStarSystem(rng, opts, starIndex) {
    const { lifeFreq, ringThreshold, moonFreq, orbitBias } = opts;

    const log = [];
    const starRoll = roll2d6(rng);
    const starLabel = STAR_2D6[starRoll];

    const countRoll = roll2d6(rng);
    const planetCount = clamp(countRoll, 3, 12);

    const deck = shuffle(buildDeck(), rng);

    const planets = [];
    for (let i = 1; i <= planetCount; i++) {
      const base = roll2d6(rng);

      let bias = 0;
      if (orbitBias > 0) {
        if (i <= 3) bias = -1 * orbitBias;
        else if (i <= 7) bias = 0;
        else bias = 1 * orbitBias;
      }

      const typeRoll = clamp(base + bias, 2, 12);
      const typeLabel = PLANET_2D6[typeRoll];

      const ringRoll = d(20, rng);
      const rings = ringRoll >= ringThreshold;

      const isGas = typeLabel.toLowerCase().includes("gas giant");

      let life = "None";
      if (!isGas) {
        const lifeRoll = d(100, rng);
        if (lifeRoll <= lifeFreq) {
          life = (d(100, rng) <= 35) ? "Complex" : "Microbial";
        }
      }

      let civ = "None";
      if (!isGas && life !== "None") {
        if (d(4, rng) === 1) {
          const card = deck.pop();
          civ = `${card.rank}${card.suit} ${DOMAIN_BY_SUIT[card.suit]} / ${levelFromRank(card.rank)}`;
        }
      }

      let moons = 0;
      if (d(100, rng) <= moonFreq) {
        moons = isGas ? d(5, rng) : d(3, rng);
      }

      log.push(
        `S${starIndex} P${i}: ${typeLabel} | rings:${rings?"YES":"no"}(d20=${ringRoll}) | life:${life} | civ:${civ} | moons:${moons}`
      );

      planets.push({ orbit:i, typeLabel, rings, ringRoll, life, civ, moons });
    }

    return {
      starRoll,
      starLabel,
      planetCount,
      planets,
      log: [
        `STAR S${starIndex} 2d6=${starRoll} -> ${starLabel}`,
        `PLANETS S${starIndex} 2d6=${countRoll} -> ${planetCount}`,
        ...log
      ].join("\n"),
    };
  }

  function genCluster(starCount, opts) {
    const { seedInput } = opts;
    const { seed, rng } = makeRng(seedInput);

    const stars = [];
    const clusterLog = [];
    clusterLog.push(`SEED: ${seed}`);
    clusterLog.push(`STAR COUNT: ${starCount}`);
    clusterLog.push(`PARAMS: lifeFreq=${opts.lifeFreq}% | rings=d20>=${opts.ringThreshold} | moonFreq=${opts.moonFreq}% | orbitBias=${opts.orbitBias}`);
    clusterLog.push("");

    for (let s = 1; s <= starCount; s++) {
      const sys = genStarSystem(rng, opts, s);
      stars.push({ index: s, ...sys });
      clusterLog.push(sys.log);
      clusterLog.push("");
    }

    const name = `CLUSTER-${seed.replace(/\s+/g,"-").slice(0,12)}`;
    return { name, seed, starCount, stars, log: clusterLog.join("\n") };
  }

  const $ = (id) => document.getElementById(id);

  function planetPaletteClass(typeLabel) {
    const t = (typeLabel || "").toLowerCase();
    if (t.includes("ocean")) return "p-ocean";
    if (t.includes("desert")) return "p-desert";
    if (t.includes("jungle")) return "p-jungle";
    if (t.includes("ice")) return "p-ice";
    if (t.includes("gas giant")) return "p-gas";
    if (t.includes("rock") || t.includes("crater") || t.includes("airless") || t.includes("temperate")) return "p-rocky";
    return "";
  }

  function starPaletteClass(starLabel) {
    const s = (starLabel || "").toLowerCase();
    if (s.includes("blue giant")) return "s-blue";
    if (s.includes("yellow-white")) return "s-yellowwhite";
    if (s === "yellow star") return "s-yellow";
    if (s.includes("orange")) return "s-orange";
    if (s.includes("white star")) return "s-white";
    if (s.includes("red dwarf")) return "s-reddwarf";
    if (s.includes("white dwarf")) return "s-whitedwarf";
    if (s.includes("neutron")) return "s-neutron";
    if (s.includes("black hole")) return "s-blackhole";
    if (s.includes("binary")) return "s-binary";
    return "s-yellow";
  }

  function makeBodyCircle({ kind, size, label, dataType, rings }) {
    const el = document.createElement("div");

    let palette = "";
    if (kind === "planet") {
      const typeLabel = (dataType || "").split(":")[1] || "";
      palette = planetPaletteClass(typeLabel);
    } else if (kind === "star") {
      const starLabel = (dataType || "").split(":")[1] || "";
      palette = starPaletteClass(starLabel);
    }

    el.className =
      `body ${kind}` +
      (rings ? " ring" : "") +
      (palette ? ` ${palette}` : "");

    el.style.width = size + "px";
    el.style.height = size + "px";
    el.setAttribute("data-asset", dataType);
    el.title = label;

    return el;
  }

  function renderCluster(cluster) {
    $("sysName").textContent = cluster.name;
    $("sysSeed").textContent = cluster.seed;
    $("starText").textContent = `${cluster.starCount} stars`;
    $("countText").textContent = "—";

    const strip = $("strip");
    strip.innerHTML = "";

    cluster.stars.forEach((sys) => {
      const starSection = document.createElement("div");
      starSection.style.display = "flex";
      starSection.style.alignItems = "center";
      starSection.style.gap = "14px";
      starSection.style.paddingRight = "16px";
      starSection.style.borderRight = "1px dashed rgba(255,255,255,0.12)";
      starSection.style.marginRight = "16px";

      const starGroup = document.createElement("div");
      starGroup.className = "orbitGroup";

      const starCircle = makeBodyCircle({
        kind: "star",
        size: sizeForStar(sys.starLabel),
        label: `S${sys.index} ${sys.starLabel}`,
        dataType: `STAR:${sys.starLabel}`,
        rings: false,
      });

      const starLab = document.createElement("div");
      starLab.className = "label";
      starLab.textContent = `S${sys.index}`;

      const starSub = document.createElement("div");
      starSub.className = "subLabel";
      starSub.textContent = `${sys.starLabel} · planets:${sys.planetCount}`;

      starGroup.appendChild(starCircle);
      starGroup.appendChild(starLab);
      starGroup.appendChild(starSub);

      starSection.appendChild(starGroup);

      sys.planets.forEach((p) => {
        const g = document.createElement("div");
        g.className = "orbitGroup";

        const line = document.createElement("div");
        line.className = "orbitLine";
        g.appendChild(line);

        const planetCircle = makeBodyCircle({
          kind: "planet",
          size: sizeForPlanet(p.typeLabel),
          label: `S${sys.index} P${p.orbit} ${p.typeLabel}`,
          dataType: `PLANET:${p.typeLabel}`,
          rings: p.rings,
        });

        const moonsWrap = document.createElement("div");
        moonsWrap.className = "moons";
        for (let m = 0; m < p.moons; m++) {
          const moon = document.createElement("div");
          moon.className = "moon";
          moon.setAttribute("data-asset", "MOON");
          moonsWrap.appendChild(moon);
        }

        const lab = document.createElement("div");
        lab.className = "label";
        lab.textContent = `P${p.orbit}`;

        const sub = document.createElement("div");
        sub.className = "subLabel";
        sub.textContent = `${p.typeLabel} · life:${p.life}`;

        g.appendChild(planetCircle);
        g.appendChild(moonsWrap);
        g.appendChild(lab);
        g.appendChild(sub);

        starSection.appendChild(g);
      });

      strip.appendChild(starSection);
    });

    $("log").textContent = cluster.log;

    const bw = document.getElementById("batchWrap");
    if (bw) bw.style.display = "none";
  }

  function getOpts() {
    return {
      seedInput: $("seed").value,
      lifeFreq: clamp(parseInt($("lifeFreq").value || "0", 10), 0, 100),
      ringThreshold: clamp(parseInt($("ringThreshold").value || "11", 10), 2, 20),
      moonFreq: clamp(parseInt($("moonFreq").value || "0", 10), 0, 100),
      orbitBias: clamp(parseInt($("orbitBias").value || "1", 10), 0, 3),
    };
  }

  $("gen1").addEventListener("click", () => renderCluster(genCluster(1, getOpts())));
  $("gen10").addEventListener("click", () => renderCluster(genCluster(10, getOpts())));
  $("gen20").addEventListener("click", () => renderCluster(genCluster(20, getOpts())));

  renderCluster(genCluster(1, getOpts()));
</script>
</body>
</html>
